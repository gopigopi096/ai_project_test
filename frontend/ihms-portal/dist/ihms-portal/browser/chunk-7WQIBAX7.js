import{a as s}from"./chunk-TR43IUZ2.js";import{Db as h,H as o,K as a,Kb as c,N as i,e as n}from"./chunk-GX3TN4JH.js";var S=(()=>{class r{constructor(t,e){this.http=t,this.router=e,this.TOKEN_KEY="ihms_token",this.REFRESH_TOKEN_KEY="ihms_refresh_token",this.USER_KEY="ihms_user",this.currentUserSubject=new n(this.getStoredUser()),this.currentUser$=this.currentUserSubject.asObservable()}login(t){return this.http.post(`${s.authUrl}/login`,t).pipe(o(e=>{this.storeTokens(e.accessToken,e.refreshToken),this.storeUser(e.user),this.currentUserSubject.next(e.user)}))}register(t){return this.http.post(`${s.authUrl}/register`,t)}logout(){localStorage.removeItem(this.TOKEN_KEY),localStorage.removeItem(this.REFRESH_TOKEN_KEY),localStorage.removeItem(this.USER_KEY),this.currentUserSubject.next(null),this.router.navigate(["/auth/login"])}refreshToken(){let t=this.getRefreshToken();return this.http.post(`${s.authUrl}/refresh`,{refreshToken:t}).pipe(o(e=>{this.storeTokens(e.accessToken,e.refreshToken)}))}isAuthenticated(){let t=this.getToken();if(!t)return!1;try{return JSON.parse(atob(t.split(".")[1])).exp*1e3>Date.now()}catch{return!1}}getToken(){return localStorage.getItem(this.TOKEN_KEY)}getRefreshToken(){return localStorage.getItem(this.REFRESH_TOKEN_KEY)}getCurrentUser(){return this.currentUserSubject.value}hasRole(t){return this.getCurrentUser()?.roles?.includes(t)??!1}storeTokens(t,e){localStorage.setItem(this.TOKEN_KEY,t),localStorage.setItem(this.REFRESH_TOKEN_KEY,e)}storeUser(t){localStorage.setItem(this.USER_KEY,JSON.stringify(t))}getStoredUser(){let t=localStorage.getItem(this.USER_KEY);return t?JSON.parse(t):null}static{this.\u0275fac=function(e){return new(e||r)(i(h),i(c))}}static{this.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();export{S as a};
