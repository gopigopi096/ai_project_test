import{a as xe}from"./chunk-ZVF4A3NO.js";import{a as fe,b as ge,c as ve,d as _e}from"./chunk-WP5NUATV.js";import{a as pe,b as ue}from"./chunk-CJI4PPME.js";import{a as de,b as se}from"./chunk-EF2XRC37.js";import"./chunk-5SHJWNIK.js";import{b as ae,c as me}from"./chunk-AM5E43BK.js";import{a as ie,b as ne,d as oe,g as re}from"./chunk-RKG5H5Y5.js";import"./chunk-DABKM3GA.js";import{a as le,b as ce}from"./chunk-5JXYUGER.js";import"./chunk-TR43IUZ2.js";import"./chunk-ZXLXF7DL.js";import{a as Z,c as ee,g as te}from"./chunk-GQNV5PIV.js";import{b as j,d as p,f as U,g as $,j as H,k as J,l as z,m as Q,n as W,o as K,p as X,r as Y}from"./chunk-WSFNJNB2.js";import{Ab as N,Bb as k,Da as t,Dc as V,Ea as e,Fa as u,Ja as b,Kb as D,Lb as T,Ma as g,Mc as A,Oa as v,Qc as q,Rc as B,S as E,Sc as L,Tc as R,Uc as G,Va as F,W as s,Wa as i,X as f,Ya as S,db as w,fa as l,ga as _,hb as y,jb as h,sa as x,ua as c,vb as O,wb as P}from"./chunk-GX3TN4JH.js";import{a as I,b as M}from"./chunk-35PI25VP.js";function be(m,d){if(m&1&&(t(0,"mat-option",26),i(1),e()),m&2){let o=d.$implicit;c("value",o.id),l(),S(" ",o.name," ")}}function Se(m,d){if(m&1){let o=b();t(0,"button",45),g("click",function(){s(o);let n=v().index,a=v();return f(a.removeItem(n))}),t(1,"mat-icon"),i(2,"delete"),e()()}}function Ce(m,d){if(m&1){let o=b();t(0,"div",27)(1,"mat-form-field",28)(2,"mat-label"),i(3,"Description"),e(),u(4,"input",29),e(),t(5,"mat-form-field",30)(6,"mat-label"),i(7,"Category"),e(),t(8,"mat-select",31)(9,"mat-option",32),i(10,"Consultation"),e(),t(11,"mat-option",33),i(12,"Procedure"),e(),t(13,"mat-option",34),i(14,"Medication"),e(),t(15,"mat-option",35),i(16,"Lab Test"),e(),t(17,"mat-option",36),i(18,"Room Charge"),e(),t(19,"mat-option",37),i(20,"Other"),e()()(),t(21,"mat-form-field",38)(22,"mat-label"),i(23,"Qty"),e(),t(24,"input",39),g("input",function(){let n=s(o).index,a=v();return f(a.calculateItemAmount(n))}),e()(),t(25,"mat-form-field",40)(26,"mat-label"),i(27,"Unit Price"),e(),t(28,"input",41),g("input",function(){let n=s(o).index,a=v();return f(a.calculateItemAmount(n))}),e()(),t(29,"mat-form-field",42)(30,"mat-label"),i(31,"Amount"),e(),u(32,"input",43),e(),x(33,Se,3,0,"button",44),e()}if(m&2){let o=d.index,r=v();c("formGroupName",o),l(33),c("ngIf",r.items.length>1)}}function Ie(m,d){m&1&&u(0,"mat-spinner",46)}function Me(m,d){m&1&&(t(0,"span"),i(1,"Create Invoice"),e())}var Xe=(()=>{class m{constructor(o,r,n,a){this.fb=o,this.router=r,this.billingService=n,this.snackBar=a,this.isLoading=!1,this.minDate=new Date,this.patients=[{id:1,name:"John Doe"},{id:2,name:"Jane Smith"},{id:3,name:"Bob Wilson"}],this.invoiceForm=this.fb.group({patientId:["",p.required],dueDate:["",p.required],discountAmount:[0],notes:[""],items:this.fb.array([this.createItem()])})}ngOnInit(){}get items(){return this.invoiceForm.get("items")}createItem(){return this.fb.group({description:["",p.required],category:["CONSULTATION",p.required],quantity:[1,[p.required,p.min(1)]],unitPrice:[0,[p.required,p.min(0)]],amount:[{value:0,disabled:!0}]})}addItem(){this.items.push(this.createItem())}removeItem(o){this.items.removeAt(o)}calculateItemAmount(o){let r=this.items.at(o),n=r.get("quantity")?.value||0,a=r.get("unitPrice")?.value||0,C=n*a;r.patchValue({amount:C})}calculateSubtotal(){return this.items.controls.reduce((o,r)=>{let n=r.get("quantity")?.value||0,a=r.get("unitPrice")?.value||0;return o+n*a},0)}calculateTotal(){let o=this.calculateSubtotal(),r=this.invoiceForm.get("discountAmount")?.value||0;return o-r}onSubmit(){if(this.invoiceForm.invalid)return;this.isLoading=!0;let o=this.invoiceForm.getRawValue(),r=M(I({},o),{dueDate:o.dueDate.toISOString().split("T")[0],items:o.items.map(n=>M(I({},n),{amount:n.quantity*n.unitPrice}))});this.billingService.createInvoice(r).subscribe({next:()=>{this.snackBar.open("Invoice created successfully","Close",{duration:3e3}),this.router.navigate(["/billing"])},error:()=>{this.isLoading=!1,this.snackBar.open("An error occurred. Please try again.","Close",{duration:3e3})}})}static{this.\u0275fac=function(r){return new(r||m)(_(X),_(D),_(xe),_(pe))}}static{this.\u0275cmp=E({type:m,selectors:[["app-invoice-form"]],standalone:!0,features:[w],decls:67,vars:17,consts:[["picker",""],[1,"container"],[1,"page-header-row"],["mat-icon-button","","routerLink","/billing"],[1,"inline-header"],[1,"form-container"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline"],["formControlName","patientId"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","dueDate",3,"matDatepicker","min"],["matSuffix","",3,"for"],["formArrayName","items"],["class","item-row",3,"formGroupName",4,"ngFor","ngForOf"],["mat-stroked-button","","type","button",3,"click"],[1,"summary-row"],["matInput","","type","number","formControlName","discountAmount"],[1,"summary-row","grand-total"],["appearance","outline",1,"form-field-full"],["matInput","","formControlName","notes","rows","3"],[1,"actions-row"],["mat-button","","type","button","routerLink","/billing"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["diameter","20",4,"ngIf"],[4,"ngIf"],[3,"value"],[1,"item-row",3,"formGroupName"],["appearance","outline",1,"description-field"],["matInput","","formControlName","description"],["appearance","outline",1,"category-field"],["formControlName","category"],["value","CONSULTATION"],["value","PROCEDURE"],["value","MEDICATION"],["value","LAB_TEST"],["value","ROOM_CHARGE"],["value","OTHER"],["appearance","outline",1,"qty-field"],["matInput","","type","number","formControlName","quantity",3,"input"],["appearance","outline",1,"price-field"],["matInput","","type","number","formControlName","unitPrice",3,"input"],["appearance","outline",1,"amount-field"],["matInput","","formControlName","amount","readonly",""],["mat-icon-button","","color","warn","type","button",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","type","button",3,"click"],["diameter","20"]],template:function(r,n){if(r&1){let a=b();t(0,"div",1)(1,"div",2)(2,"div")(3,"button",3)(4,"mat-icon"),i(5,"arrow_back"),e()(),t(6,"h1",4),i(7,"Create Invoice"),e()()(),t(8,"mat-card",5)(9,"mat-card-content")(10,"form",6),g("ngSubmit",function(){return s(a),f(n.onSubmit())}),t(11,"h3"),i(12,"Patient Information"),e(),t(13,"div",7)(14,"mat-form-field",8)(15,"mat-label"),i(16,"Patient"),e(),t(17,"mat-select",9),x(18,be,2,2,"mat-option",10),e(),t(19,"mat-error"),i(20,"Patient is required"),e()(),t(21,"mat-form-field",8)(22,"mat-label"),i(23,"Due Date"),e(),u(24,"input",11)(25,"mat-datepicker-toggle",12)(26,"mat-datepicker",null,0),t(28,"mat-error"),i(29,"Due date is required"),e()()(),t(30,"h3"),i(31,"Invoice Items"),e(),t(32,"div",13),x(33,Ce,34,2,"div",14),e(),t(34,"button",15),g("click",function(){return s(a),f(n.addItem())}),t(35,"mat-icon"),i(36,"add"),e(),i(37," Add Item "),e(),t(38,"h3"),i(39,"Summary"),e(),t(40,"div",16)(41,"span"),i(42,"Subtotal:"),e(),t(43,"span"),i(44),y(45,"number"),e()(),t(46,"div",7)(47,"mat-form-field",8)(48,"mat-label"),i(49,"Discount"),e(),u(50,"input",17),e()(),t(51,"div",18)(52,"span"),i(53,"Total:"),e(),t(54,"span"),i(55),y(56,"number"),e()(),t(57,"mat-form-field",19)(58,"mat-label"),i(59,"Notes"),e(),u(60,"textarea",20),e(),t(61,"div",21)(62,"button",22),i(63,"Cancel"),e(),t(64,"button",23),x(65,Ie,1,0,"mat-spinner",24)(66,Me,2,0,"span",25),e()()()()()()}if(r&2){let a=F(27);l(10),c("formGroup",n.invoiceForm),l(8),c("ngForOf",n.patients),l(6),c("matDatepicker",a)("min",n.minDate),l(),c("for",a),l(8),c("ngForOf",n.items.controls),l(11),S("$",h(45,11,n.calculateSubtotal(),"1.2-2"),""),l(11),S("$",h(56,14,n.calculateTotal(),"1.2-2"),""),l(9),c("disabled",n.isLoading||n.invoiceForm.invalid),l(),c("ngIf",n.isLoading),l(),c("ngIf",!n.isLoading)}},dependencies:[k,O,P,N,Y,H,j,J,U,$,z,K,Q,W,T,te,Z,ee,me,ae,re,ie,ne,oe,L,q,B,G,R,se,de,A,_e,fe,ge,ve,V,ue,ce,le],styles:[".page-header-row[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:24px}.inline-header[_ngcontent-%COMP%]{display:inline;margin-left:8px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}h3[_ngcontent-%COMP%]{margin-top:24px;margin-bottom:16px;color:#666}h3[_ngcontent-%COMP%]:first-of-type{margin-top:0}.item-row[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;margin-bottom:8px}.description-field[_ngcontent-%COMP%]{flex:3}.category-field[_ngcontent-%COMP%]{flex:2}.qty-field[_ngcontent-%COMP%], .price-field[_ngcontent-%COMP%], .amount-field[_ngcontent-%COMP%]{flex:1}.summary-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:8px 0;max-width:300px;margin-left:auto}.grand-total[_ngcontent-%COMP%]{font-weight:500;font-size:18px;border-top:2px solid #333;margin-bottom:24px}"]})}}return m})();export{Xe as InvoiceFormComponent};
